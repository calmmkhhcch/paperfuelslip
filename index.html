<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>華航A321紙本油單</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #e6e6e6;
            color: #333;
            padding: 20px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1250px;
            margin: 0 auto;
            background-color: white;
            border: 1px solid #999;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .print-header {
            background-color: #f0f0f0;
            padding: 8px 15px;
            border-bottom: 1px solid #999;
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }
        
        .main-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            padding: 20px 0;
            border-bottom: 2px solid #000;
            background-color: #f9f9f9;
            letter-spacing: 1px;
        }
        
        .china-oil-info {
            text-align: right;
            padding: 12px 25px;
            border-bottom: 1px solid #999;
            background-color: #f5f5f5;
            font-weight: bold;
            font-size: 15px;
        }
        
        .china-oil-info input {
            width: 180px;
            border: 1px solid #999;
            padding: 8px 12px;
            font-size: 15px;
            margin-left: 12px;
        }
        
        .fuel-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .fuel-table td {
            border: 1px solid #999;
            padding: 10px 8px;
            vertical-align: middle;
            word-wrap: break-word;
        }
        
        .fuel-table .header-row {
            background-color: #e9ecef;
            font-weight: bold;
            text-align: center;
            font-size: 13px;
            padding: 10px 6px;
            line-height: 1.3;
        }
        
        .fuel-table .sub-header {
            background-color: #f8f9fa;
            font-weight: normal;
            text-align: center;
            font-size: 14px;
        }
        
        .fuel-table .section-title {
            background-color: #e9ecef;
            font-weight: bold;
            text-align: center;
            font-size: 20px;
            padding: 15px 12px;
            letter-spacing: 1px;
        }
        
        .input-cell {
            padding: 8px 6px !important;
            background-color: white !important;
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            border: 1px solid #bbb;
            border-radius: 4px;
            outline: none;
            background-color: white;
            font-size: 14px;
            padding: 8px 6px;
            text-align: center;
        }
        
        input[type="text"]:focus, input[type="number"]:focus {
            border-color: #003366;
            box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
        }
        
        .calculation-cell {
            background-color: #e7f3ff !important;
            font-weight: bold;
            text-align: center;
            font-size: 15px;
            padding: 10px 6px !important;
        }
        
        .result-cell {
            background-color: #f0ffe8 !important;
            font-weight: bold;
            text-align: center;
            font-size: 15px;
            padding: 10px 6px !important;
        }
        
        .small-text {
            font-size: 12px;
            color: #555;
            line-height: 1.4;
        }
        
        .remark-horizontal {
            text-align: center;
            font-weight: bold;
            font-size: 15px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            line-height: 1.3;
        }
        
        .instructions {
            margin-top: 30px;
            padding: 25px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
        }
        
        .instructions h3 {
            color: #003366;
            margin-bottom: 18px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #003366;
        }
        
        .instructions ul {
            padding-left: 28px;
            margin-bottom: 25px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 25px;
        }
        
        button {
            padding: 14px 30px;
            border: 1px solid #999;
            border-radius: 5px;
            background-color: #f0f0f0;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            min-width: 160px;
        }
        
        button:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        #calculateBtn {
            background-color: #003366;
            color: white;
            border-color: #003366;
        }
        
        #calculateBtn:hover {
            background-color: #002244;
        }
        
        #resetBtn {
            background-color: #f0f0f0;
            color: #333;
        }
        
        #resetBtn:hover {
            background-color: #e0e0e0;
        }
        
        /* 簽名欄 */
        .signature-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-top: 2px solid #999;
        }
        
        .signature-table td {
            border: 1px solid #999;
            padding: 18px 15px;
            vertical-align: top;
            text-align: left;
            width: 33.33%;
        }
        
        .signature-table .signature-label {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            font-size: 16px;
        }
        
        .signature-table .no-input {
            color: #666;
            padding: 10px 8px;
            font-style: italic;
            font-size: 15px;
        }
        
        @media print {
            .no-print {
                display: none;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            input {
                border: none !important;
                background-color: transparent !important;
                -webkit-print-color-adjust: exact;
            }
            
            .fuel-table td {
                padding: 8px 6px;
            }
            
            .signature-table td {
                padding: 12px 10px;
            }
        }
        
        /* 空行樣式 */
        .empty-row td {
            border: none;
            height: 10px;
            background-color: transparent;
        }
        
        /* 調整"油單有寫照抄"文字大小 */
        .copy-text {
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
            margin-top: 4px;
            color: #666;
        }
        
        /* 調整MTOW右側單元格 */
        .mtow-cell {
            background-color: #f9f9f9;
            text-align: center;
            padding: 8px !important;
        }
        
        /* 調整DENSITY輸入框大小 */
        .density-input {
            width: 70px !important;
            display: inline-block;
            text-align: center;
            font-size: 14px;
            padding: 6px 5px;
        }
        
        /* DISTRIBUTION表格的特定列寬 */
        .tank-col {
            width: 9%;
        }
        
        .required-col {
            width: 22%;
        }
        
        .remaining-col {
            width: 22%;
        }
        
        .post-service-col {
            width: 22%;
        }
        
        .remark-col {
            width: 13%;
            padding: 12px 8px !important;
        }
        
        /* 調整需求總油量單元格 */
        .demand-total {
            background-color: #f0f0f0;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
        }
        
        /* 修正TANK方向 - 改為水平顯示 */
        .tank-header-horizontal {
            text-align: center;
            font-weight: bold;
            padding: 10px 6px !important;
            writing-mode: horizontal-tb !important;
            transform: none !important;
            font-size: 13px;
        }
        
        /* 修正需求油量樣式 - 只顯示文字，沒有輸入框 */
        .demand-cell {
            text-align: center;
            padding: 10px 6px !important;
            background-color: #f9f9f9;
            font-size: 13px;
        }
        
        /* 合併格子的寬度調整 */
        .calculated-fuel-merged {
            width: 48%;
            text-align: center;
            padding: 10px 6px;
            font-size: 13px;
        }
        
        .difference-merged {
            width: 48%;
            text-align: center;
            padding: 10px 6px;
            font-size: 13px;
        }
        
        /* 特別調整日期輸入框樣式 */
        #flightDate {
            font-size: 14px;
            padding: 8px 5px;
        }
        
        /* 調整航班資訊行的內邊距 */
        .flight-info-row td {
            padding: 8px 5px !important;
        }
        
        /* 調整表頭行的字體大小 */
        .compact-header {
            font-size: 11px !important;
            line-height: 1.2 !important;
        }
        
        /* 簽名欄靜態文字 */
        .signature-static {
            font-size: 18px;
            font-weight: bold;
            padding: 12px 0;
            border-bottom: 2px solid #999;
            margin-top: 6px;
        }
        
        /* =============== 重新設計FUEL INFORMATION部分，與圖片完全一致 =============== */
        .fuel-info-container {
            width: 100%;
            border-collapse: collapse;
            border-top: 1px solid #999;
        }
        
        /* 左邊格：STATION FUEL */
        .station-fuel-cell {
            width: 20%;
            border: 1px solid #999;
            height: 200px;
            vertical-align: middle;
            text-align: center;
            background-color: #f9f9f9;
            font-weight: bold;
            font-size: 18px;
            line-height: 1.5;
            padding: 0 10px;
        }
        
        /* 中間格：分為上下三部分 */
        .middle-cell {
            width: 40%;
            border: 1px solid #999;
            padding: 0;
            height: 200px;
        }
        
        /* 右邊格：DIFFERENCE TOLERANCE - 加寬 */
        .tolerance-cell {
            width: 40%;
            border: 1px solid #999;
            padding: 0;
            height: 200px;
            background-color: #f9f9f9;
        }
        
        /* 中間格的各部分 */
        .fuel-details-part {
            height: 33.33%;
            padding: 10px 15px;
            border-bottom: 1px solid #999;
            display: flex;
            align-items: center;
        }
        
        .fuel-details-part:last-child {
            border-bottom: none;
        }
        
        /* JET燃料部分 */
        .jet-fuel-part {
            justify-content: space-between;
        }
        
        .jet-fuel-label {
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .jet-fuel-input {
            border: 1px solid #ccc;
            background-color: white;
            padding: 8px 10px;
            text-align: center;
            font-size: 14px;
            width: 150px;
        }
        
        /* DENSITY部分 */
        .density-part {
            justify-content: flex-start;
        }
        
        .density-label {
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
            white-space: nowrap;
        }
        
        /* BONDED和DOMESTIC部分 */
        .bonded-domestic-part {
            justify-content: space-between;
        }
        
        .bonded-section, .domestic-section {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .bonded-section {
            margin-right: 10px;
        }
        
        .domestic-section {
            margin-left: 10px;
        }
        
        /* DIFFERENCE TOLERANCE 表格 */
        .tolerance-table {
            width: 100%;
            border-collapse: collapse;
            height: 100%;
            table-layout: fixed;
        }
        
        .tolerance-table td {
            border: 1px solid #ccc;
            padding: 8px 10px;
            vertical-align: middle;
        }
        
        .tolerance-main-header {
            font-weight: bold;
            text-align: center;
            font-size: 15px;
            background-color: #e9ecef;
            height: 40px;
        }
        
        .tolerance-sub-header {
            font-weight: bold;
            text-align: center;
            font-size: 13px;
            background-color: #f0f0f0;
            height: 35px;
        }
        
        .tolerance-range {
            text-align: left;
            font-size: 13px;
            padding-left: 15px;
            width: 70%;
        }
        
        .tolerance-value {
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            width: 30%;
        }
        
        /* 響應式調整 */
        @media (max-width: 1024px) {
            .container {
                overflow-x: auto;
            }
            
            .fuel-table {
                min-width: 1100px;
            }
            
            .signature-table {
                display: block;
                overflow-x: auto;
            }
            
            .signature-table td {
                min-width: 200px;
            }
            
            .fuel-info-container {
                min-width: 950px;
            }
        }
        
        /* 確保表格在寬螢幕上不會太窄 */
        @media (min-width: 1200px) {
            .container {
                width: 100%;
                max-width: 1300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="print-header">
            華航A321燃油計算紙本油單 | 內部使用
        </div>
        
        <div class="main-title">
            A321 FUEL LOAD & SERVICE RECORD
        </div>
        
        <!-- 加完油拿到的油單資料 -->
        <div class="china-oil-info">
            加完油拿到的油單資料: 
            <input type="number" id="chinaOilLiters" placeholder="輸入加油量(Liters)">
        </div>
        
        <!-- 航班資訊表格 -->
        <table class="fuel-table">
            <!-- 航班資訊行 -->
            <tr class="flight-info-row">
                <td class="header-row schedule-date-cell compact-header">SCHEDULE<br>DATE</td>
                <td class="input-cell date-input-cell">
                    <input type="text" id="flightDate" placeholder="日期">
                </td>
                <td class="header-row flight-no-cell compact-header">FLIGHT<br>NO.</td>
                <td class="static-text flight-no-static-cell">航班號</td>
                <td class="header-row acft-no-cell compact-header">ACFT<br>NO.</td>
                <td class="static-text acft-no-static-cell">機號</td>
                <td class="header-row dep-cell compact-header">DEP.<br>STN.</td>
                <td class="static-text dep-static-cell">出發地</td>
                <td class="header-row arr-cell compact-header">ARR.<br>STN.</td>
                <td class="static-text arr-static-cell">到達地</td>
            </tr>
            
            <!-- OFP TOTAL FUEL 行 -->
            <tr class="ofp-row">
                <td colspan="2" class="header-row ofp-total-label">OFP TOTAL FUEL :</td>
                <td class="input-cell ofp-total-input">
                    <input type="number" id="ofpTotalFuel" placeholder="輸入油量">
                    <div class="copy-text">油單有寫照抄</div>
                </td>
                <td colspan="2" class="small-text lbs-including-label">LBS, INCLUDING TAXI FUEL :</td>
                <td class="input-cell taxi-fuel-input">
                    <input type="number" id="taxiFuel" placeholder="輸入油量">
                    <div class="copy-text">油單有寫照抄</div>
                </td>
                <td class="small-text lbs-cell">LBS</td>
                <td class="header-row metered-fuel-label">METERED FUEL ADDED</td>
                <td class="result-cell metered-fuel-result" id="meteredFuelAdded">0</td>
                <td class="small-text us-gal-cell">US GAL</td>
            </tr>
            
            <!-- FINAL FUEL 行 -->
            <tr>
                <td colspan="2" class="header-row final-fuel-label">FINAL FUEL :</td>
                <td class="calculation-cell final-fuel-result" id="finalFuel">0</td>
                <td colspan="4" class="small-text final-fuel-desc">LBS. (ENTER POST-SERVICE TOTAL FOR OPERATION LOG)</td>
                <td class="small-text mtow-label">□MTOW:</td>
                <td class="mtow-cell-wide" colspan="2">____________</td>
                <td class="small-text lsb-cell">LSB, (______T)</td>
            </tr>
            
            <!-- DISTRIBUTION 標題 -->
            <tr>
                <td colspan="11" class="section-title">DISTRIBUTION</td>
            </tr>
        </table>
        
        <!-- DISTRIBUTION 表格 -->
        <table class="fuel-table">
            <tr>
                <td class="header-row tank-col tank-header-horizontal">TANK</td>
                <td class="header-row required-col">REQUIRED (LBS)</td>
                <td class="header-row remaining-col">REMAINING (LBS)</td>
                <td class="header-row post-service-col">POST SERVICE (LBS)</td>
                <td class="header-row remark-col">
                    <div class="remark-horizontal">REMARK</div>
                </td>
            </tr>
            
            <!-- 油箱1 -->
            <tr>
                <td class="sub-header tank-col">1</td>
                <td class="demand-cell required-col">需求油量</td>
                <td class="input-cell remaining-col">
                    <input type="number" id="remaining1" class="remaining-fuel" placeholder="剩餘油量" value="0">
                </td>
                <td class="input-cell post-service-col">
                    <input type="number" id="postService1" class="post-service-fuel" placeholder="加油後油量" value="0">
                </td>
                <td class="remark-col" rowspan="6">
                    <!-- 空白備註區域 -->
                </td>
            </tr>
            
            <!-- 油箱2 -->
            <tr>
                <td class="sub-header tank-col">2</td>
                <td class="demand-cell required-col">需求油量</td>
                <td class="input-cell remaining-col">
                    <input type="number" id="remaining2" class="remaining-fuel" placeholder="剩餘油量" value="0">
                </td>
                <td class="input-cell post-service-col">
                    <input type="number" id="postService2" class="post-service-fuel" placeholder="加油後油量" value="0">
                </td>
            </tr>
            
            <!-- 油箱CTR -->
            <tr>
                <td class="sub-header tank-col">CTR</td>
                <td class="demand-cell required-col">需求油量</td>
                <td class="input-cell remaining-col">
                    <input type="number" id="remainingCtr" class="remaining-fuel" placeholder="剩餘油量" value="0">
                </td>
                <td class="input-cell post-service-col">
                    <input type="number" id="postServiceCtr" class="post-service-fuel" placeholder="加油後油量" value="0">
                </td>
            </tr>
            
            <!-- TOTAL行 -->
            <tr>
                <td class="header-row tank-col">TOTAL</td>
                <td class="demand-total required-col">需求總油量 寫在這裡</td>
                <td class="calculation-cell remaining-col" id="totalRemaining">0</td>
                <td class="calculation-cell post-service-col" id="totalPostService">0</td>
            </tr>
            
            <!-- *CALCULATED FUEL行 -->
            <tr>
                <td class="header-row calculated-fuel-merged" colspan="3">*CALCULATED FUEL</td>
                <td class="calculation-cell post-service-col" id="calculatedFuel">0</td>
            </tr>
            
            <!-- DIFFERENCE行 -->
            <tr>
                <td class="header-row difference-merged" colspan="3">
                    DIFFERENCE<br>
                    <span class="small-text">(Calculated Fuel-Total Post service)</span>
                </td>
                <td class="result-cell post-service-col" id="difference">0</td>
            </tr>
        </table>
        
        <!-- FUEL INFORMATION 標題 -->
        <table class="fuel-table">
            <tr>
                <td colspan="11" class="section-title">FUEL INFORMATION</td>
            </tr>
        </table>
        
        <!-- FUEL INFORMATION 內容 - 根據最新要求重新設計 -->
        <table class="fuel-info-container">
            <tr>
                <!-- 左邊格：STATION FUEL -->
                <td class="station-fuel-cell">
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
                        STATION<br>FUEL
                    </div>
                </td>
                
                <!-- 中間格：分為三部分 -->
                <td class="middle-cell">
                    <!-- 第一部分：JET燃料類型 -->
                    <div class="fuel-details-part jet-fuel-part">
                        <span class="jet-fuel-label">JET -A1, JET-A, JETP-B, OTHER</span>
                        <input type="text" id="fuelType" class="jet-fuel-input" placeholder="___________">
                    </div>
                    
                    <!-- 第二部分：DENSITY -->
                    <div class="fuel-details-part density-part">
                        <span class="density-label">DENSITY:</span>
                        <input type="number" id="density" value="6.55" step="0.01" min="0" style="width: 70px; text-align: center; padding: 8px; margin-right: 10px;">
                        <span>LBS/GAL</span>
                    </div>
                    
                    <!-- 第三部分：BONDED 和 DOMESTIC -->
                    <div class="fuel-details-part bonded-domestic-part">
                        <div class="bonded-section">
                            <div style="font-weight: bold;">BONDED</div>
                            <div style="color: #666; font-size: 12px; margin-top: 5px;">不用寫</div>
                        </div>
                        <div class="domestic-section">
                            <div style="font-weight: bold;">DOMESTIC</div>
                            <div style="color: #666; font-size: 12px; margin-top: 5px;">不用寫</div>
                        </div>
                    </div>
                </td>
                
                <!-- 右邊格：DIFFERENCE TOLERANCE - 重新設計 -->
                <td class="tolerance-cell">
                    <table class="tolerance-table">
                        <!-- 第一行：DIFFERENCE TOLERANCE -->
                        <tr>
                            <td colspan="2" class="tolerance-main-header">DIFFERENCE TOLERANCE</td>
                        </tr>
                        <!-- 第二行：POST SERVICE 和 DIFFERENCE -->
                        <tr>
                            <td class="tolerance-sub-header">POST SERVICE</td>
                            <td class="tolerance-sub-header">DIFFERENCE</td>
                        </tr>
                        <!-- 第三行：<50,000 LBS 和 ±800 LBS -->
                        <tr>
                            <td class="tolerance-range">&lt;50,000 LBS</td>
                            <td class="tolerance-value">±800 LBS</td>
                        </tr>
                        <!-- 第四行：50,000-99,999 LBS 和 ±1,500 LBS -->
                        <tr>
                            <td class="tolerance-range">50,000-99,999 LBS</td>
                            <td class="tolerance-value">±1,500 LBS</td>
                        </tr>
                        <!-- 第五行：100,000-149,999 LBS 和 ±1,700 LBS -->
                        <tr>
                            <td class="tolerance-range">100,000-149,999 LBS</td>
                            <td class="tolerance-value">±1,700 LBS</td>
                        </tr>
                        <!-- 第六行：150,000-199,999 LBS 和 ±2,000 LBS -->
                        <tr>
                            <td class="tolerance-range">150,000-199,999 LBS</td>
                            <td class="tolerance-value">±2,000 LBS</td>
                        </tr>
                        <!-- 第七行：≥200,000 LBS 和 ±2,400 LBS -->
                        <tr>
                            <td class="tolerance-range">≥200,000 LBS</td>
                            <td class="tolerance-value">±2,400 LBS</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        
        <!-- 簽名欄 -->
        <table class="signature-table">
            <tr>
                <td>
                    <span class="signature-label">FLT CREW :</span>
                    <div class="signature-static">教官簽名</div>
                </td>
                <td>
                    <span class="signature-label">FUEL BY :</span>
                    <div class="signature-static">機務簽名</div>
                </td>
                <td>
                    <span class="signature-label">OFP TOTAL FUEL BY :</span>
                    <div class="no-input">不用寫</div>
                </td>
            </tr>
        </table>
    </div>
    
    <!-- 說明和按鈕 -->
    <div class="instructions no-print">
        <h3>使用說明</h3>
        <ul>
            <li><strong>剩餘油量 (REMAINING)</strong>: 輸入各油箱剩餘油量，系統會自動計算總和。</li>
            <li><strong>加油後油量 (POST SERVICE)</strong>: 輸入各油箱加油後油量，系統會自動計算總和並顯示為 FINAL FUEL。</li>
            <li><strong>加完油拿到的油單資料</strong>: 輸入加油量 (Liters)，系統會自動換算為 METERED FUEL ADDED (US GAL)。</li>
            <li><strong>密度 (DENSITY)</strong>: 可手動調整燃油密度，預設為 6.55 LBS/GAL。</li>
            <li><strong>*CALCULATED FUEL</strong>: 自動計算 = 剩餘油量總和 + (密度 × METERED FUEL ADDED)。</li>
            <li><strong>DIFFERENCE</strong>: 自動計算 = CALCULATED FUEL - POST SERVICE 總和。</li>
        </ul>
        
        <div class="button-group">
            <button id="calculateBtn">計算與驗證</button>
            <button id="resetBtn">重設表格</button>
            <button onclick="window.print()">列印表格</button>
        </div>
    </div>

    <script>
        // DOM元素
        const chinaOilLitersInput = document.getElementById('chinaOilLiters');
        const meteredFuelAddedElement = document.getElementById('meteredFuelAdded');
        const remainingInputs = document.querySelectorAll('.remaining-fuel');
        const postServiceInputs = document.querySelectorAll('.post-service-fuel');
        const totalRemainingElement = document.getElementById('totalRemaining');
        const totalPostServiceElement = document.getElementById('totalPostService');
        const calculatedFuelElement = document.getElementById('calculatedFuel');
        const differenceElement = document.getElementById('difference');
        const densityInput = document.getElementById('density');
        const finalFuelElement = document.getElementById('finalFuel');
        const flightDateInput = document.getElementById('flightDate');
        
        // 計算按鈕和重設按鈕
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // 設定台灣當天日期
        function setTaiwanDate() {
            const now = new Date();
            // 台灣時區 (UTC+8)
            const taiwanTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            const year = taiwanTime.getUTCFullYear();
            const month = String(taiwanTime.getUTCMonth() + 1).padStart(2, '0');
            const day = String(taiwanTime.getUTCDate()).padStart(2, '0');
            // 使用更簡潔的日期格式
            const dateString = `${year}/${month}/${day}`;
            flightDateInput.value = dateString;
        }
        
        // 計算METERED FUEL ADDED (升轉加侖)
        function calculateMeteredFuel() {
            const liters = parseFloat(chinaOilLitersInput.value) || 0;
            // 1升 = 0.26417加侖
            const gallons = liters * 0.26417;
            // 四捨五入到整數
            const roundedGallons = Math.round(gallons);
            meteredFuelAddedElement.textContent = roundedGallons.toLocaleString();
            return roundedGallons;
        }
        
        // 計算剩餘油量總和
        function calculateRemainingTotal() {
            let total = 0;
            remainingInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            totalRemainingElement.textContent = total.toLocaleString();
            return total;
        }
        
        // 計算加油後油量總和
        function calculatePostServiceTotal() {
            let total = 0;
            postServiceInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            totalPostServiceElement.textContent = total.toLocaleString();
            
            // 更新FINAL FUEL
            finalFuelElement.textContent = total.toLocaleString();
            
            return total;
        }
        
        // 計算CALCULATED FUEL
        function calculateCalculatedFuel() {
            const remainingTotal = calculateRemainingTotal();
            const meteredFuel = calculateMeteredFuel();
            const density = parseFloat(densityInput.value) || 6.55;
            
            // CALCULATED FUEL = 剩餘油量總和 + (密度 * METERED FUEL ADDED)
            const calculatedFuel = remainingTotal + (density * meteredFuel);
            calculatedFuelElement.textContent = Math.round(calculatedFuel).toLocaleString();
            return Math.round(calculatedFuel);
        }
        
        // 計算DIFFERENCE
        function calculateDifference() {
            const calculatedFuel = calculateCalculatedFuel();
            const postServiceTotal = calculatePostServiceTotal();
            
            // DIFFERENCE = CALCULATED FUEL - POST SERVICE 總量
            const difference = calculatedFuel - postServiceTotal;
            differenceElement.textContent = Math.round(difference).toLocaleString();
            
            // 根據差值設置顏色
            const absDiff = Math.abs(difference);
            if (absDiff > 2400) {
                differenceElement.style.color = '#d32f2f'; // 紅色
                differenceElement.style.backgroundColor = '#ffebee';
            } else if (absDiff > 800) {
                differenceElement.style.color = '#f57c00'; // 橙色
                differenceElement.style.backgroundColor = '#fff3e0';
            } else {
                differenceElement.style.color = '#388e3c'; // 綠色
                differenceElement.style.backgroundColor = '#f1f8e9';
            }
            
            return difference;
        }
        
        // 執行所有計算
        function performAllCalculations() {
            calculateMeteredFuel();
            calculateRemainingTotal();
            calculatePostServiceTotal();
            calculateCalculatedFuel();
            calculateDifference();
            
            alert('計算完成！油單已準備就緒。');
        }
        
        // 重設表格
        function resetForm() {
            if (confirm('確定要重設所有資料嗎？此操作無法復原。')) {
                // 重置所有輸入欄位
                const allInputs = document.querySelectorAll('input[type="text"], input[type="number"]');
                allInputs.forEach(input => {
                    if (input.id === 'density') {
                        input.value = 6.55;
                    } else if (input.id === 'chinaOilLiters' || 
                              input.classList.contains('remaining-fuel') || 
                              input.classList.contains('post-service-fuel')) {
                        input.value = '0';
                    } else if (!input.disabled && input.id !== 'flightDate') {
                        input.value = '';
                    }
                });
                
                // 重置所有計算結果
                const resultElements = document.querySelectorAll('.result-cell, .calculation-cell');
                resultElements.forEach(element => {
                    if (element.id !== 'fuelType' && 
                        element.id !== 'difference') {
                        element.textContent = '0';
                    }
                });
                
                // 重置difference顏色
                differenceElement.style.color = '';
                differenceElement.style.backgroundColor = '#f0ffe8';
                
                // 重新設定日期
                setTaiwanDate();
                
                alert('表格已重設！');
            }
        }
        
        // 事件監聽器
        chinaOilLitersInput.addEventListener('input', () => {
            calculateMeteredFuel();
            calculateCalculatedFuel();
            calculateDifference();
        });
        
        densityInput.addEventListener('input', () => {
            calculateCalculatedFuel();
            calculateDifference();
        });
        
        // 為所有剩餘油量輸入框添加事件監聽
        remainingInputs.forEach(input => {
            input.addEventListener('input', () => {
                calculateRemainingTotal();
                calculateCalculatedFuel();
                calculateDifference();
            });
        });
        
        // 為所有加油後油量輸入框添加事件監聽
        postServiceInputs.forEach(input => {
            input.addEventListener('input', () => {
                calculatePostServiceTotal();
                calculateDifference();
            });
        });
        
        // 按鈕事件監聽
        calculateBtn.addEventListener('click', performAllCalculations);
        resetBtn.addEventListener('click', resetForm);
        
        // 初始化計算
        window.addEventListener('DOMContentLoaded', () => {
            // 設置初始值
            setTaiwanDate();
            calculateMeteredFuel();
            calculateRemainingTotal();
            calculatePostServiceTotal();
            calculateCalculatedFuel();
            calculateDifference();
        });
    </script>
</body>
    </html>
